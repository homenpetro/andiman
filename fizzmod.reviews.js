!function(){function e(r,i,t){function s(o,u){if(!i[o]){if(!r[o]){var d="function"==typeof require&&require;if(!u&&d)return d(o,!0);if(n)return n(o,!0);var h=new Error("Cannot find module '"+o+"'");throw h.code="MODULE_NOT_FOUND",h}var a=i[o]={exports:{}};r[o][0].call(a.exports,function(e){return s(r[o][1][e]||e)},a,a.exports,e,r,i,t)}return i[o].exports}for(var n="function"==typeof require&&require,o=0;o<t.length;o++)s(t[o]);return s}return e}()({1:[function(e,r,i){"use strict";!function(e,r,i,t,s){var n={MDReviewsEntity:"RE",productId:null,reviewsCache:{},user:{},url:{GETPROFILE:"/no-cache/profileSystem/getProfile",LOGIN:"/login"},events:{READY:"Fizzmod.Reviews.Ready",REVIEWS_UPDATED:"Fizzmod.Reviews.Updated"},errors:{productIdNotDefined:"'productId' is not defined",reviewsNotDefined:"'reviews' is not defined",ratingNotDefined:"'rating' is not defined",ratingNotValid:"'rating' must be a number between 1 and 5",titleNotDefined:"'title' is not defined",userNotDefined:"'user' is not defined",userHasNoReview:"user has no active review",reviewUserIdNotDefined:"'reviewUserId' is not defined",reviewUserIdNotFound:"The 'reviewUserId' was not found in reviews"},init:function(r,i){var t=this;if(!r)return this._error("productIdNotDefined");this.productId=r;var s=[],n=this.getReviews();if(s.push(n),this._isValidUser(i))this.user=i;else{var o=e.get(this.url.GETPROFILE);s.push(o)}return e.when.apply(e,s).then(function(){for(var e=arguments.length,r=Array(e),i=0;i<e;i++)r[i]=arguments[i];if(2===r.length){var s=r[1][0];t._isValidUser(s)&&(t.user=s)}t._trigger(t.events.READY,[t.reviewsCache,t.user])}),this},_trigger:function(r,i){e(t).trigger(r,i)},_error:function(e,r){console.log(this.errors[e]),r&&console.log("Data:",r)},_isValidUser:function(e){return!!e&&!!e.IsUserDefined},_updateUserReview:function(i){var t=this;if(!i)return this._error("reviewsNotDefined");if(!this.isLoggedIn())return this._error("userNotDefined");if(!this.reviewsCache[this.user.UserId]){var s=this.reviewsCache[this.user.UserId]={helpfull:{yes:[],no:[]}},n=this.user.Email.match("@");n=null!=n?n[0].toString():this.user.Email,s.name=n,this.user.FirstName&&(s.name=this.user.FirstName),this.user.LastName&&(s.name+=" "+this.user.LastName)}e.extend(this.reviewsCache[this.user.UserId],i);var o=JSON.stringify(this.reviewsCache),u=r.MasterData.insertUpdate(this.productId,{reviews:o},this.MDReviewsEntity);return u.done(function(e){return t._trigger(t.events.REVIEWS_UPDATED,JSON.parse(e.getResults().reviews))}),u},login:function(){var r=this;if("undefined"!=typeof vtexid)vtexid.start(),e(document).on("click",".vtexIdUI-close",function(e){r.redirectOnLoginFail&&(document.referrer?t.location.href=document.referrer:t.location.href="/")});else{var i="/"+t.location.href.split("/").splice(3).join("/");t.location.href=this.url.LOGIN+"?ReturnUrl="+i}},isLoggedIn:function(){return!!this.user&&!!this.user.IsUserDefined},hasComments:function(){if(e.isEmptyObject(this.reviewsCache))return!1;var r=!0;for(var i in this.reviewsCache)if(this.reviewsCache[i].body&&this.reviewsCache[i].active){r=!1;break}return!r},getReviews:function(){var e=this,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.productId;if(!i)return this._error("productIdNotDefined");var t=r.MasterData.get(i,["reviews"],this.MDReviewsEntity);return t.done(function(r){var i=r.getResults(),t={};i&&i.reviews&&"string"==typeof i.reviews&&(t=JSON.parse(i.reviews)),e.reviewsCache=t,e._trigger(e.events.REVIEWS_UPDATED,t)}),t},publishRating:function(r){if(!this.isLoggedIn())return this.login();if(!r)return this._error("ratingNotDefined");if(e.isNumeric(r)||(r=parseInt(r,10)),r>5||r<1)return this._error("ratingNotValid");var i={rating:r};return this._updateUserReview(i)},publishTitle:function(e){if(!this.isLoggedIn())return this.login();if(!e)return this._error("titleNotDefined");var r={title:e};return this._updateUserReview(r)},publishBody:function(e){if(!this.isLoggedIn())return this.login();if(!e)return this._error("bodyNotDefined");var r={body:e};return this._updateUserReview(r)},submitReview:function(){if(!this.isLoggedIn())return this.login();var e=this.reviewsCache[this.user.UserId];if(!e)return this._error("userHasNoReview");if(!e.rating)return this._error("ratingNotDefined");if(!e.title)return this._error("titleNotDefined");if(!e.body)return this._error("bodyNotDefined");var r={active:!0,date:new Date};return this._updateUserReview(r)},voteHelpfullReview:function(e){if(!this.isLoggedIn())return this.login();if(!e)return this._error("reviewUserIdNotDefined");if(!this.reviewsCache[e])return this._error("reviewUserIdNotFound");var r=this.reviewsCache[e],i=r.helpfull;return-1==i.yes.indexOf(this.user.UserId)&&i.yes.push(this.user.UserId),-1!=i.no.indexOf(this.user.UserId)&&i.no.splice(i.no.indexOf(this.user.UserId),1),this._updateUserReview(r)},voteUnhelpfullReview:function(e){if(!this.isLoggedIn())return this.login();if(!e)return this._error("reviewUserIdNotDefined");if(!this.reviewsCache[e])return this._error("reviewUserIdNotFound");var r=this.reviewsCache[e],i=r.helpfull;return-1==i.no.indexOf(this.user.UserId)&&i.no.push(this.user.UserId),-1!=i.yes.indexOf(this.user.UserId)&&i.yes.splice(i.yes.indexOf(this.user.UserId),1),this._updateUserReview(r)}};r.Reviews=n}(jQuery,Fizzmod,vtexjs.checkout,window)},{}]},{},[1]);
//# sourceMappingURL=fizzmod.reviews.js.map
